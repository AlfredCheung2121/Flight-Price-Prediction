---
title: "Model"
format: html
Author: Alfred Cheung

execute: 
  message: false
  echo: false
  warning: false
---


```{r}
library(tidyverse)
library(readxl)             
library(tidymodels)     
library(broom)          
library(marginaleffects) 
library(easystats) 
library(stringr)
```

```{r}
x <- read_xlsx("Data_Train.xlsx")



x1 <- x %>%
  mutate(
    duration_hr = str_extract(Duration, "\\d+h") %>%             # 抓 "2h"
      str_remove("h") %>%                                        # 去除 h
      as.numeric(),
    
    duration_min = str_extract(Duration, "\\d+m") %>%            # 抓 "50m"
      str_remove("m") %>%                                        # 去除 m
      as.numeric(),
    
    duration_hr = if_else(is.na(duration_hr), 0, duration_hr),   # 沒有小時時補 0
    duration_min = if_else(is.na(duration_min), 0, duration_min),# 沒有分鐘時補 0
    
    duration_total_hr = duration_hr + duration_min / 60          # 合併為小時數
  )

```


```{r}
x2<-linear_reg()|>
    fit(Price ~ Airline + Total_Stops + duration_total_hr, data = x1)


```



```{r}
library(tibble)
library(gt)

# Create tribble with all coefficients
tribble(
  ~Variable, ~Coefficient,
  "(Intercept)", 7753.1051,
  "AirlineAir India", 1851.8817,
  "AirlineGoAir", -37.7565,
  "AirlineIndiGo", 267.0302,
  "AirlineJet Airways", 4158.9695,
  "AirlineJet Airways Business", 49940.6468,
  "AirlineMultiple carriers", 3048.7654,
  "AirlineMultiple carriers Premium economy", 3658.2822,
  "AirlineSpiceJet", -207.9855,
  "AirlineTrujet", -3615.5031,
  "AirlineVistara", 2195.2227,
  "AirlineVistara Premium economy", 5125.2326,
  "Total_Stops2 stops", 1980.4793,
  "Total_Stops3 stops", 3275.2042,
  "Total_Stops4 stops", 8059.2467,
  "Total_Stopsnon-stop", -3917.8899,
  "duration_total_hr", 0.7378
)|>
    gt() 

# Display the tibble
```


$$
\begin{aligned}
\text{Price} =\ & 7753.11 + 1851.88 \cdot \text{Airline}_{\text{Air India}} - 37.76 \cdot \text{Airline}_{\text{GoAir}} + 267.03 \cdot \text{Airline}_{\text{IndiGo}} \\
& + 4158.97 \cdot \text{Airline}_{\text{Jet Airways}} + 49940.65 \cdot \text{Airline}_{\text{Jet Airways Business}} \\
& + 3048.77 \cdot \text{Airline}_{\text{Multiple carriers}} + 3658.28 \cdot \text{Airline}_{\text{Multiple carriers Premium economy}} \\
& - 207.99 \cdot \text{Airline}_{\text{SpiceJet}} - 3615.50 \cdot \text{Airline}_{\text{Trujet}} + 2195.22 \cdot \text{Airline}_{\text{Vistara}} \\
& + 5125.23 \cdot \text{Airline}_{\text{Vistara Premium economy}} + 1980.48 \cdot \text{TotalStops}_{\text{2 stops}} \\
& + 3275.20 \cdot \text{TotalStops}_{\text{3 stops}} + 8059.25 \cdot \text{TotalStops}_{\text{4 stops}} \\
& - 3917.89 \cdot \text{TotalStops}_{\text{non-stop}} + 0.74 \cdot \text{Duration (hr)}
\end{aligned}
$$




```{r}
tidy(x2, conf.int =TRUE)
``` 
```{r}
predictions(x2)


#Make more plot prediction 

#combine the two table into one table and the formate 
```


Most airline and stop-related features significantly influence flight prices, with Jet Airways Business class showing the largest positive effect, while non-stop flights tend to reduce prices substantially.











