---
title: "Model"
format: html
Author: Alfred Cheung

execute: 
  message: false
  echo: false
  warning: false
---


```{r}
library(tidyverse)
library(readxl)             
library(tidymodels)     
library(broom)          
library(marginaleffects) 
library(easystats) 
library(stringr)
```

```{r}
x <- read_xlsx("Data_Train.xlsx")

# Use a R code to do the mutate

x1 <- x %>%
  filter(Airline != "Jet Airways Business")|>
  mutate(
    duration_hr = str_extract(Duration, "\\d+h") %>%             # 抓 "2h"
      str_remove("h") %>%                                        # 去除 h
      as.numeric(),
    
    duration_min = str_extract(Duration, "\\d+m") %>%            # 抓 "50m"
      str_remove("m") %>%                                        # 去除 m
      as.numeric(),
    
    duration_hr = if_else(is.na(duration_hr), 0, duration_hr),   # 沒有小時時補 0
    duration_min = if_else(is.na(duration_min), 0, duration_min),# 沒有分鐘時補 0
    
    duration_total_hr = duration_hr + duration_min / 60          # 合併為小時數
  )

```


```{r}
x2<-linear_reg()|>
    fit(Price ~ Airline + Total_Stops + duration_total_hr, data = x1)


```


## Table
```{r}
library(tibble)
library(gt)

# Create tribble with all coefficients
tribble(
  ~Variable, ~Coefficient, ~conf.low, ~conf.high,
  "(Intercept)", 7753, 7389, 8117,
  "AirlineAir India", 1846, 1473, 2218,
  "AirlineGoAir", -37, -577, 503,
  "AirlineIndiGo", 267, -89, 624,
  "AirlineJet Airways", 4158, 3806, 4511,
  "AirlineMultiple carriers", 3050, 2668, 3433,
  "AirlineMultiple carriers Premium economy", 3661, 1983, 5339,
  "AirlineSpiceJet", -208, -601, 184,
  "AirlineTrujet", -3615, -9549, 2319,
  "AirlineVistara", 2197, 1766, 2627,
  "AirlineVistara Premium economy", 5124, 1688, 8561,
  "Total_Stops2 stops", 2002, 1805, 2200,
  "Total_Stops3 stops", 3286, 2383, 4190,
  "Total_Stops4 stops", 8073, 2145, 14001,
  "Total_Stopsnon-stop", -3917, -4100, -3733,
  "duration_total_hr", 0.495, -10.4, 11.4
)|>
    gt()|>
    tab_spanner(label = "95% confidence interval", columns = c(`conf.low`, `conf.high`))

# Display the tibble
```

## Linear Regession Model Equation
$$
\begin{aligned}
\hat{Y} =\ & 7753 \\
& + 1846 \cdot \text{Airline}_{\text{Air India}} \\
& -\ 37 \cdot \text{Airline}_{\text{GoAir}} \\
& + 267 \cdot \text{Airline}_{\text{IndiGo}} \\
& + 4158 \cdot \text{Airline}_{\text{Jet Airways}} \\
& + 3050 \cdot \text{Airline}_{\text{Multiple carriers}} \\
& + 3661 \cdot \text{Airline}_{\text{Multiple carriers Premium economy}} \\
& -\ 208 \cdot \text{Airline}_{\text{SpiceJet}} \\
& -\ 3615 \cdot \text{Airline}_{\text{Trujet}} \\
& + 2197 \cdot \text{Airline}_{\text{Vistara}} \\
& + 5124 \cdot \text{Airline}_{\text{Vistara Premium economy}} \\
& + 2002 \cdot \text{Stops}_{\text{2 stops}} \\
& + 3286 \cdot \text{Stops}_{\text{3 stops}} \\
& + 8073 \cdot \text{Stops}_{\text{4 stops}} \\
& -\ 3917 \cdot \text{Stops}_{\text{non-stop}} \\
& + 0.495 \cdot \text{duration\_total\_hr}
\end{aligned}
$$



```{r}
plot_predictions(x2, by = ("Airline"))+coord_flip()


#Make more plot prediction 

#combine the two table into one table and the formate 
```


The plot illustrates the predicted ticket prices across different airlines based on a linear regression model that incorporates Airline, Total Stops, and Total Duration (hours) as predictors. Each line represents a specific airline, showing how price varies across the observed range of values. Airlines such as Jet Airways, Air India, and Multiple Carriers display wider price ranges and more variability, while budget airlines like GoAir and SpiceJet show tighter, more consistent pricing patterns. The dense overlap of lines in the lower price range (below 20,000) suggests that many airlines operate within similar pricing bands, though premium carriers and classes (e.g., Vistara Premium Economy) occupy higher price segments. This model-based visualization helps identify airline-specific pricing trends and supports comparison across carrier types.









